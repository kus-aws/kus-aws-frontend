import{j as e,c as T,a as E,u as z}from"./index-DNUojM5K.js";import{r as n}from"./vendor-CwHBbTcV.js";import{B as f,c as F,f as D}from"./api-D2lwCfWm.js";import{C as y,a as k}from"./card-DZUl0o2B.js";import{T as $,c as _,d as L,L as S,A,R as P,e as U,f as M,C as Q,g as B}from"./lucide-Da5moREV.js";const R=n.forwardRef(({className:s,type:o,...i},u)=>e.jsx("input",{type:o,className:T("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:u,...i}));R.displayName="Input";function K({messageId:s,onFeedback:o,onComment:i,className:u=""}){const[a,l]=n.useState(null),[g,c]=n.useState(!1),[d,m]=n.useState(""),x=h=>{l(h),o?.(h,s),h==="positive"&&setTimeout(()=>l(null),2e3)},j=()=>{d.trim()&&(i?.(d.trim(),s),m(""),c(!1))},v=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),j())};return e.jsxs("div",{className:`flex items-center space-x-2 mt-2 ${u}`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>x("positive"),className:`h-8 px-2 ${a==="positive"?"bg-green-100 text-green-700 hover:bg-green-200":"hover:bg-gray-100"}`,"aria-label":"ê¸ì •ì  í”¼ë“œë°±","aria-pressed":a==="positive",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>x("negative"),className:`h-8 px-2 ${a==="negative"?"bg-red-100 text-red-700 hover:bg-red-200":"hover:bg-gray-100"}`,"aria-label":"ë¶€ì •ì  í”¼ë“œë°±","aria-pressed":a==="negative",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>c(!g),className:"h-8 px-2 hover:bg-gray-100","aria-label":"ì½”ë©˜íŠ¸ ì¶”ê°€","aria-expanded":g,children:e.jsx(L,{className:"w-4 h-4"})}),a&&e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:a==="positive"?"ğŸ‘ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤":"ğŸ‘ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤"}),g&&e.jsxs("div",{className:"flex-1 ml-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("textarea",{value:d,onChange:h=>m(h.target.value),onKeyPress:v,placeholder:"ì˜ê²¬ì„ ì…ë ¥í•´ì£¼ì„¸ìš”...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:2,maxLength:500}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(f,{size:"sm",onClick:j,disabled:!d.trim(),className:"h-8 px-3",children:"ì „ì†¡"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{c(!1),m("")},className:"h-6 px-2 text-xs",children:"ì·¨ì†Œ"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[d.length,"/500ì"]})]})]})}function G({items:s,onSelect:o,disabled:i=!1,className:u=""}){return s?.length?e.jsxs("div",{className:`mt-3 ${u}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(S,{className:"w-3 h-3 text-amber-500"}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"ì—°ê³„ ì§ˆë¬¸"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map((a,l)=>e.jsx(f,{variant:"outline",size:"sm",onClick:()=>o(a),disabled:i,className:"text-xs bg-white hover:bg-blue-50 border-blue-200 text-blue-700 max-w-full disabled:opacity-50 disabled:cursor-not-allowed h-6 px-2 py-1",title:i?"ì‘ë‹µ ìƒì„± ì¤‘...":"ì´ ì§ˆë¬¸ìœ¼ë¡œ ì´ì–´ì„œ ë¬»ê¸°",children:e.jsx("span",{className:"truncate text-xs",children:a})},`${a}-${l}`))})]}):null}function O(){const s=n.useRef(null),o=n.useRef([]),i=n.useCallback(()=>{s.current={startTime:performance.now(),totalChunks:0,totalChars:0,averageChunkSize:0,streamingDuration:0,charsPerSecond:0},o.current=[]},[]),u=n.useCallback(c=>{if(!s.current)return;const d=performance.now(),m=c.length;s.current.totalChunks++,s.current.totalChars+=m,s.current.averageChunkSize=s.current.totalChars/s.current.totalChunks,s.current.firstChunkTime||(s.current.firstChunkTime=d),s.current.lastChunkTime=d,o.current.push(d)},[]),a=n.useCallback(()=>{if(!s.current)return;const c=performance.now();s.current.streamingDuration=c-s.current.startTime,s.current.streamingDuration>0&&(s.current.charsPerSecond=s.current.totalChars/s.current.streamingDuration*1e3),typeof window<"u"&&window.location.hostname==="localhost"&&console.log("ğŸ“Š ìŠ¤íŠ¸ë¦¬ë° ì„±ëŠ¥ ë©”íŠ¸ë¦­:",{ì´_ì‘ë‹µì‹œê°„:`${(s.current.streamingDuration/1e3).toFixed(2)}ì´ˆ`,ì´_ë¬¸ììˆ˜:s.current.totalChars,ì´_ì²­í¬ìˆ˜:s.current.totalChunks,í‰ê· _ì²­í¬í¬ê¸°:s.current.averageChunkSize.toFixed(1),ì´ˆë‹¹_ë¬¸ììˆ˜:s.current.charsPerSecond.toFixed(1),ì²«_ì²­í¬_ì§€ì—°:s.current.firstChunkTime?`${((s.current.firstChunkTime-s.current.startTime)/1e3).toFixed(2)}ì´ˆ`:"N/A"}),s.current.totalChars>100},[]),l=n.useCallback(()=>s.current,[]),g=n.useCallback(()=>{s.current=null,o.current=[]},[]);return{startStreaming:i,recordChunk:u,endStreaming:a,getMetrics:l,reset:g}}function J(s){const[o,i]=n.useState([]),[u,a]=n.useState(!1),[l,g]=n.useState(),[c,d]=n.useState(()=>{if(typeof window>"u")return"cid-server";const N=localStorage.getItem("cid"),C=N??crypto.randomUUID();return N||localStorage.setItem("cid",C),C}),m=n.useRef(!1),{endStreaming:x}=O();async function j(N){if(!N.trim())return;if(m.current){console.warn("[useChat] Duplicate send attempt blocked");return}m.current=!0,a(!0);const C=crypto.randomUUID();i(r=>[...r,{role:"user",text:N,messageId:C}]);let w;const t=crypto.randomUUID();i(r=>(w=r.length,[...r,{role:"assistant",text:"",suggestions:[],messageId:t}]));try{const r=await F({userQuestion:N,major:s.major,subField:s.subField,conversationId:c,followupMode:"never",suggestCount:0});i(p=>{const b=[...p];return b[w]&&(b[w]={...b[w],text:r.aiResponse}),b}),r.conversationId&&r.conversationId!==c&&(d(r.conversationId),localStorage.setItem("cid",r.conversationId)),r.conversationId&&D({conversationId:r.conversationId,major:s.major,subField:s.subField,suggestCount:s.suggestCount??3}).then(p=>{p.length>0&&i(b=>b.map(I=>I.messageId===t?{...I,suggestions:p}:I))}).catch(p=>{console.warn("[useChat] fetchSuggestions failed:",p)}),a(!1),x()}catch(r){a(!1),g(r instanceof Error?r.message:"ì±„íŒ… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),i(p=>p.filter(b=>b.messageId!==t)),x()}finally{m.current=!1}}const v=n.useCallback(()=>{a(!1),x(),m.current=!1},[x]);return n.useEffect(()=>()=>{x(),m.current=!1},[x]),n.useMemo(()=>({messages:o,loading:u,error:l,conversationId:c,send:j,cancel:v}),[o,u,l,c,j,v])}const H={economics:{name:"ê²½ì œí•™",emoji:"ğŸ’°"},mathematics:{name:"ìˆ˜í•™",emoji:"ğŸ“"},"computer-science":{name:"ì»´í“¨í„°ê³µí•™",emoji:"ğŸ’»"}},V={economics:{macroeconomics:{name:"ê±°ì‹œê²½ì œí•™",sampleQuestions:["GDPê°€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”","ì¸í”Œë ˆì´ì…˜ì˜ ì›ì¸ì€?","í†µí™”ì •ì±…ê³¼ ì¬ì •ì •ì±…ì˜ ì°¨ì´ëŠ”?"]}},mathematics:{statistics:{name:"í†µê³„í•™",sampleQuestions:["ì‹ ë¢°êµ¬ê°„ì´ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì£¼ì„¸ìš”","í‘œì¤€í¸ì°¨ì˜ ì˜ë¯¸ëŠ”?","ê°€ì„¤ê²€ì • ê³¼ì •ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”"]}},"computer-science":{algorithms:{name:"ì•Œê³ ë¦¬ì¦˜",sampleQuestions:["ë²„ë¸”ì •ë ¬ì˜ ì‹œê°„ë³µì¡ë„ëŠ”?","ì´ì§„íƒìƒ‰íŠ¸ë¦¬ì˜ íŠ¹ì§•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”","ë™ì ê³„íšë²•ì´ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì£¼ì„¸ìš”"]}}};function W(s){return H[s]}function X(s,o){return V[s]?.[o]}function te(){const[,s]=E("/chat/:majorId/:subId"),[,o]=z(),i=s?.majorId,u=s?.subId,a=n.useMemo(()=>i?W(i):null,[i]),l=n.useMemo(()=>i&&u?X(i,u):null,[i,u]);n.useEffect(()=>{a&&l&&console.log("[Chat] Initialized with:",{major:a.name,subField:l.name})},[a,l]);const{messages:g,loading:c,error:d,send:m}=J({major:a?.name||"",subField:l?.name||"",suggestCount:3,conversationId:void 0}),[x,j]=n.useState(""),v=async t=>{if(t.preventDefault(),!x.trim()||c)return;const r=x.trim();j(""),await m(r)},h=async t=>{c||await m(t)},N=async t=>{c||await m(t)},C=()=>{window.location.reload()},w=()=>{const t=g.filter(r=>r.role==="user").pop();t&&m(t.text)};return!a||!l?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"ì¹´í…Œê³ ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(f,{onClick:()=>o("/"),children:"í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>o("/"),className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"ì¹´í…Œê³ ë¦¬ë¡œ ëŒì•„ê°€ê¸°"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"ğŸ’»"}),e.jsx("span",{className:"font-medium",children:a.name}),e.jsx("span",{className:"text-gray-400",children:">"}),e.jsx("span",{className:"font-medium",children:l.name})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsxs(f,{variant:"outline",size:"sm",onClick:w,className:"flex items-center space-x-2","data-testid":"button-retry",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"ì¬ì‹œë„"})]}),e.jsxs(f,{variant:"outline",onClick:C,className:"flex items-center space-x-2","data-testid":"button-clear-chat",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"ëŒ€í™” ì´ˆê¸°í™”"})]})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx(y,{className:"mb-6 bg-blue-50 border-blue-200",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(S,{className:"w-5 h-5 text-blue-600"}),e.jsxs("h2",{className:"text-lg font-semibold text-blue-800",children:[a.name," - ",l.name," ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤"]})]}),e.jsx("p",{className:"text-blue-700",children:"AI íŠœí„°ì™€ í•¨ê»˜ í•™ìŠµí•˜ì„¸ìš”. ê¶ê¸ˆí•œ ê²ƒì„ ììœ ë¡­ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš”!"})]})}),e.jsx(y,{className:"mb-6 bg-amber-50 border-amber-200",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(S,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-amber-800",children:"ì§ˆë¬¸ ì˜ˆì‹œ"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.sampleQuestions.map((t,r)=>e.jsx(f,{variant:"outline",size:"sm",onClick:()=>N(t),className:"text-xs bg-white hover:bg-amber-100 border-amber-300 text-amber-700","data-testid":`button-sample-${r}`,disabled:c,children:t},r))})]})}),e.jsx(y,{className:"mb-6 bg-white",children:e.jsx(k,{className:"p-0",children:e.jsxs("div",{className:"h-96 overflow-y-auto p-4 space-y-4","data-testid":"chat-messages",children:[g.map((t,r)=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md ${t.role==="user"?"bg-primary text-white":"bg-gray-100 text-gray-800"} px-4 py-2 rounded-lg shadow-sm`,"data-testid":`message-${t.role}-${r}`,children:[e.jsx("p",{className:"whitespace-pre-wrap",children:t.text}),t.role==="assistant"&&t.suggestions&&t.suggestions.length>0&&e.jsx(G,{items:t.suggestions,onSelect:h,disabled:c,className:"mt-3"}),t.role==="assistant"&&e.jsx("div",{className:"mt-2",children:e.jsx(K,{messageId:t.messageId,onFeedback:(p,b)=>{console.log("Feedback:",p,b)}})})]})},t.messageId)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg shadow-sm max-w-xs lg:max-w-md",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"AIê°€ ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."})]})})}),d&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"bg-red-50 text-red-700 px-4 py-2 rounded-lg flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:d})]})})]})})}),e.jsx(y,{className:"bg-white",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("form",{onSubmit:v,className:"flex space-x-2",children:[e.jsx(R,{value:x,onChange:t=>j(t.target.value),placeholder:"ê¶ê¸ˆí•œ ê²ƒì„ ì§ˆë¬¸í•´ë³´ì„¸ìš”...",className:"flex-1",disabled:c,"data-testid":"input-message"}),e.jsx(f,{type:"submit",disabled:!x.trim()||c,className:"bg-primary text-white","data-testid":"button-send",children:c?e.jsx(M,{className:"w-4 h-4 animate-spin"}):e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Enterë¥¼ ëˆŒëŸ¬ ì „ì†¡ â€¢ Shift+Enterë¡œ ì¤„ë°”ê¿ˆ"}),e.jsx("span",{className:"text-gray-400",children:"Ctrl+K: ì…ë ¥ì°½ í¬ì»¤ìŠ¤"})]}),e.jsx("div",{className:"text-gray-400",children:"Ctrl+Enter: ë¹ ë¥¸ ì „ì†¡ â€¢ Ctrl+L: ëŒ€í™” ì´ˆê¸°í™”"})]})]})})]})]})}export{te as default};
