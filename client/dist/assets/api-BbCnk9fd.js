import{j as d,c as p,b as g,S as f}from"./index-CpnnpdjG.js";import{r as h}from"./vendor-CwHBbTcV.js";const m=g("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),w=h.forwardRef(({className:e,variant:t,size:r,asChild:o=!1,...n},u)=>{const l=o?f:"button";return d.jsx(l,{className:p(m({variant:t,size:r,className:e})),ref:u,...n})});w.displayName="Button";const a="https://2kdtuncj36tas5twwm7dsgpz5y0bkfkw.lambda-url.us-east-1.on.aws";class s extends Error{constructor(t,r,o){super(t),this.status=r,this.details=o,this.name="ApiError"}}function i(){try{return crypto.randomUUID()}catch{return`trace-${Date.now()}`}}function c(e){try{return JSON.parse(e)}catch(t){return console.warn("[api] JSON parse failed, using fallback:",t),null}}function y(e){return Array.isArray(e)?e.filter(t=>typeof t=="string"&&t.trim()).slice(0,5):[]}async function k(){{const e=await fetch(`${a}/health`,{credentials:"omit",headers:{"x-trace-id":i()}});try{return await e.json()}catch{return"ok"}}}function b(e){return e&&typeof e.aiResponse=="string"&&typeof e.conversationId=="string"}function v(e){return e&&Array.isArray(e.suggestions)}async function S(e){if(!e.userQuestion?.trim())throw new s("질문을 입력해주세요.");if(e.userQuestion.length>1e3)throw new s("질문은 1000자 이내로 입력해주세요.");if(!e.major?.trim()||!e.subField?.trim())throw new s("전공과 세부 분야를 선택해주세요.");try{console.log("[chat] Lambda direct call to:",`${a}/chat`),console.log("[chat] Request payload:",e);const t=await fetch(`${a}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-trace-id":i()},body:JSON.stringify({...e,followupMode:"never",suggestCount:0}),credentials:"omit"}),r=await t.text();if(console.log("[chat] Lambda raw response:",r),!t.ok)throw new Error(`HTTP ${t.status} ${r||"Internal Server Error"}`);const o=t.headers.get("content-type");o?.includes("application/json")||console.warn("[chat] Unexpected content-type:",o);const n=c(r);if(!n)throw new s("Lambda 응답을 파싱할 수 없습니다.");return console.log("[chat] Lambda parsed response:",n),b(n)?(n.suggestions=[],n):(console.warn("[chat] invalid response shape:",n),{aiResponse:"죄송합니다. 일시적인 오류가 발생했습니다.",conversationId:e.conversationId??"unknown",suggestions:[]})}catch(t){throw console.error("[chat] Lambda direct call failed:",t),t instanceof Error&&t.name==="AbortError"?new s("요청 시간이 초과되었습니다. 다시 시도해주세요."):new s("Lambda 서버 연결에 실패했습니다. 잠시 후 다시 시도해주세요.")}}async function A(e){try{console.log("[suggestions] Lambda direct call to:",`${a}/suggestions`);const t=await fetch(`${a}/suggestions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-trace-id":i()},body:JSON.stringify(e),credentials:"omit"}),r=await t.text();if(!t.ok)return console.warn("[suggestions] Lambda call failed:",t.status,r),[];const o=t.headers.get("content-type");o?.includes("application/json")||console.warn("[suggestions] Unexpected content-type:",o);const n=c(r);return v(n)?y(n.suggestions):(console.warn("[suggestions] invalid response shape:",n),[])}catch(t){return console.error("[suggestions] Lambda direct call failed:",t),[]}}export{w as B,S as c,A as f,k as h};
