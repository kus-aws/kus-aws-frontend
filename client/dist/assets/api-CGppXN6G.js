const s="https://2kdtuncj36tas5twwm7dsgpz5y0bkfkw.lambda-url.us-east-1.on.aws".replace("/$/","");function a(){if(!s)throw new Error("백엔드 주소 미설정: .env(또는 Vercel env)의 VITE_BACKEND_BASE를 확인하세요.")}async function l(){a();const t=await fetch(`${s}/health`,{credentials:"omit"});try{return await t.json()}catch{return"ok"}}function i(t){return t&&typeof t.aiResponse=="string"&&typeof t.conversationId=="string"}async function u(t){a();try{console.log("[chat] Request payload:",t);const e=await fetch(`${s}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({userQuestion:t.userQuestion,major:t.major,subField:t.subField,conversationId:t.conversationId,followupMode:"multi",suggestCount:3}),credentials:"omit"}),r=e.headers.get("content-type")||"",o=await e.text();let n=null;try{r.includes("application/json")&&(n=JSON.parse(o))}catch(c){console.warn("[chat] JSON parse failed:",c)}if(!e.ok)throw console.error("[chat] http",e.status,r,o),new Error(`HTTP ${e.status}: ${o||"Internal Server Error"}`);if(!n)throw new Error("서버 응답을 파싱할 수 없습니다.");return i(n)?(console.log("[chat] Response:",n),n):(console.warn("[chat] invalid response shape:",n),{aiResponse:"죄송합니다. 일시적인 오류가 발생했습니다.",conversationId:t.conversationId??"unknown",suggestions:[]})}catch(e){throw console.error("[chat] Request failed:",e),e}}export{u as c,l as h};
