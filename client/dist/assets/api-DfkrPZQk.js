const a="https://2kdtuncj36tas5twwm7dsgpz5y0bkfkw.lambda-url.us-east-1.on.aws".replace("/$/","");function i(){if(!a)throw new Error("백엔드 주소 미설정: .env(또는 Vercel env)의 VITE_BACKEND_BASE를 확인하세요.")}function u(e){return Array.isArray(e)?e.filter(t=>typeof t=="string"&&t.trim()).slice(0,5):[]}async function h(){i();const e=await fetch(`${a}/health`,{credentials:"omit"});try{return await e.json()}catch{return"ok"}}function g(e){return e&&typeof e.aiResponse=="string"&&typeof e.conversationId=="string"}function p(e){return e&&Array.isArray(e.suggestions)}async function f(e){i();try{console.log("[chat] Request payload:",e);const t=await fetch(`${a}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({userQuestion:e.userQuestion,major:e.major,subField:e.subField,conversationId:e.conversationId,followupMode:e.followupMode||"multi",suggestCount:e.suggestCount||3}),credentials:"omit"}),o=t.headers.get("content-type")||"",n=await t.text();let s=null;try{o.includes("application/json")&&(s=JSON.parse(n))}catch(l){console.warn("[chat] JSON parse failed:",l)}if(!t.ok)throw console.error("[chat] http",t.status,o,n),new Error(`HTTP ${t.status}: ${n||"Internal Server Error"}`);if(!s)throw new Error("서버 응답을 파싱할 수 없습니다.");if(!g(s))return console.warn("[chat] invalid response shape:",s),{aiResponse:"죄송합니다. 일시적인 오류가 발생했습니다.",conversationId:e.conversationId??"unknown",suggestions:[]};console.log("[chat] Response:",s);const r=s,c=r.suggestions||[];return c.length===0?(console.warn("[chat] No suggestions received. Request params were:"),console.warn("- followupMode:",e.followupMode||"multi"),console.warn("- suggestCount:",e.suggestCount||3),console.warn("- Backend might not be generating suggestions properly")):console.log("[chat] Suggestions received:",c.length,"items"),r}catch(t){throw console.error("[chat] Request failed:",t),t}}async function d(e){i();try{console.log("[suggestions] Request payload:",e);const t=await fetch(`${a}/suggestions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e),credentials:"omit"}),o=t.headers.get("content-type")||"",n=await t.text();let s=null;try{o.includes("application/json")&&(s=JSON.parse(n))}catch(r){console.warn("[suggestions] JSON parse failed:",r)}return t.ok?s?p(s)?(console.log("[suggestions] Response:",s),u(s.suggestions)):(console.warn("[suggestions] invalid response shape:",s),[]):(console.warn("[suggestions] No data received"),[]):(console.error("[suggestions] http",t.status,o,n),[])}catch(t){return console.error("[suggestions] Request failed:",t),[]}}export{f as c,d as f,h};
