const o="https://2kdtuncj36tas5twwm7dsgpz5y0bkfkw.lambda-url.us-east-1.on.aws".replace("/$/","");class a extends Error{constructor(s,e,n){super(s),this.status=e,this.details=n,this.name="ApiError"}}function i(){if(!o)throw new Error("백엔드 주소 미설정: .env(또는 Vercel env)의 VITE_BACKEND_BASE를 확인하세요.")}function c(t){return Array.isArray(t)?t.filter(s=>typeof s=="string"&&s.trim()).slice(0,5):[]}async function h(){i();const t=await fetch(`${o}/health`,{credentials:"omit"});try{return await t.json()}catch{return"ok"}}function u(t){return t&&typeof t.aiResponse=="string"&&typeof t.conversationId=="string"}function l(t){return t&&Array.isArray(t.suggestions)}async function f(t){if(!t.userQuestion?.trim())throw new a("질문을 입력해주세요.");if(t.userQuestion.length>1e3)throw new a("질문은 1000자 이내로 입력해주세요.");if(!t.major?.trim()||!t.subField?.trim())throw new a("전공과 세부 분야를 선택해주세요.");i();const s=await fetch(`${o}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,followupMode:"never",suggestCount:0}),credentials:"omit"});if(!s.ok){console.error(`[chat] HTTP ${s.status} ${s.statusText}`);const n=await s.text().catch(()=>"No error text");console.error("[chat] Error response:",n);let r="서버 오류가 발생했습니다.";return s.status===429?r="요청이 너무 많습니다. 잠시 후 다시 시도해주세요.":s.status===502?(r="백엔드 서버에 일시적인 문제가 있습니다. 잠시 후 다시 시도해주세요.",console.error("[chat] 502 Bad Gateway - 백엔드 서버 문제 발생"),console.error("[chat] 백엔드 개발자에게 다음 정보를 전달하세요:"),console.error("[chat] - 오류: 502 Bad Gateway"),console.error("[chat] - 엔드포인트: /chat"),console.error("[chat] - 응답:",n),console.error("[chat] - 시간:",new Date().toISOString())):s.status===500?r="서버에 일시적인 문제가 있습니다. 잠시 후 다시 시도해주세요.":s.status===503?r="서비스가 일시적으로 사용불가합니다. 잠시 후 다시 시도해주세요.":s.status===400?r="잘못된 요청입니다. 입력 내용을 확인해주세요.":s.status>=500&&(r="서버 내부 오류가 발생했습니다."),{aiResponse:`죄송합니다. ${r} (${s.status})`,conversationId:t.conversationId??"unknown",suggestions:[]}}const e=await s.json().catch(()=>null);return u(e)?(e.suggestions=[],e):(console.warn("[chat] invalid shape:",e),{aiResponse:"죄송합니다. 일시적인 오류가 발생했습니다.",conversationId:t.conversationId??"unknown",suggestions:[]})}async function g(t){i();const s=await fetch(`${o}/suggestions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"omit"});if(!s.ok)return console.warn("[suggestions] Backend call failed:",s.status),[];const e=await s.json().catch(()=>({suggestions:[]}));return l(e)?c(e.suggestions):(console.warn("[suggestions] invalid response shape:",e),[])}export{f as c,g as f,h};
